<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="/plantilla/template :: head">
</head>

<body>

	<div class="d-flex" id="wrapper">
		<!-- Sidebar -->
		<div class="bg-light border-right" id="sidebar-wrapper">
			<div class="sidebar-heading">J4 SOFT</div>
			<div class="list-group list-group-flush text-center">
				<nav th:replace="plantilla/template :: menu_vertical"></nav>
			</div>
		</div>
		<!-- /#sidebar-wrapper -->

		<!-- Page Content -->
		<div id="page-content-wrapper">


			<nav th:replace="plantilla/template :: menu_horizontal"></nav>

			<div class="container-fluid">


				<!-- CONTENIDO DINAMICO -->
				<div>
					<h3>Información básica</h3>


					<form th:action="@{/vistas/obreros/guardar}" method="post" th:object="${obrero}">
						<div class="form-group row">
							<label class="col-md-4" for="nombre">Nombre</label> <input class="form_registro" id="nombre"
								th:field="${obrero.trabajador.nombre}" placeholder="Nombre">
							<small class="form-text text-danger" th:if="${#fields.hasErrors('trabajador.nombre')}"
								th:errors="*{trabajador.nombre}"></small>
						</div>


						<div>
							<label class="col-md-4" for="estado">Estado</label> <select
								name="estado" id="estado">
								<option disabled selected>activo</option>
								<option value="inactivo">inactivo</option>
							</select>
						</div>
						<div class="form-group row">
							<label class="col-md-4" for="estado">Cedula</label> <input
								class="form_registro" id="cedula"
								th:field="${obrero.trabajador.cedula}" placeholder="Cédula"
								value=""> <small class="form-text text-danger"
								th:if="${#fields.hasErrors('trabajador.cedula')}"
								th:errors="*{trabajador.cedula}"></small>
						</div>
						<div>
							<label class="col-md-4" for="cargo">Cargo</label> <select
								name="cargo" id="cargo">
								<option disabled selected>Business Development</option>
								<option value="Accounting">Accounting</option>
								<option value="Human Resources">Human Resources</option>
								<option value="Research and Development">Research and
									Development</option>
							</select>
						</div>

						<div id="arl">
							
							
					
							<label class="col-md-4" for="afiliadoArl">ARL</label>
							<select	id ="id_arl" name="id_arl">
							</select> <input class="form_registro" name="codigo_afiliado_arl"
								
								placeholder="Codigo Afiliado ARL">
								<input class="form_registro" type="date" name="fecha_registro_arl">
						</div>


						<div>
							<label class="col-md-4" for="afiliadoEps">EPS</label> <select
								th:field="${obrero.trabajador.afiliadoEps.eps.id}">
								<option th:each="obj : ${listaEps}" th:value="${obj.id}"
									th:text="${obj.nombre}" />

							</select>
								<input class="form_registro"placeholder="Codigo Afiliado EPS"
								th:field="${obrero.trabajador.afiliadoEps.codigo}"
								>
								<input class="form_registro" type="date"
								th:field="${obrero.trabajador.afiliadoEps.fechaIngreso}">
						</div>
						<div>
							<label class="col-md-4" for="afiliadoFondoPension">Fondo
								de Pension</label> <select name="afiliadoFondoPension"
								th:field="${obrero.trabajador.afiliadoFondoPension.fondoPension.id}">
								<option th:each="obj : ${listaAfp}" th:value="${obj.id}"
									th:text="${obj.nombre}" />

							</select>
							<input class="form_registro" placeholder="Codigo Afiliado AFP"
								th:field="${obrero.trabajador.afiliadoFondoPension.codigo}"
							>
								<input class="form_registro" type="date"
								th:field="${obrero.trabajador.afiliadoFondoPension.fechaIngreso}">
						</div>

						<div class="row">
							<!-- <input name="id_secret" value="56"> -->
							<input type="hidden" name="id_obra" th:value="${idObra}">
							<button type="submit" class="hudsoft-btn-sm mx-auto">Crear</button>

						</div>

					</form>
				</div>
			</div>
			<!-- ./CONTENIDO DINAMICO -->
			<footer th:replace="plantilla/template :: footer"></footer>
		</div>
	</div>
	<!-- /#page-content-wrapper -->
	
	<!-- JAVASCRIPT -->
	<script>
		function getAllArlFetch() {
			let opciones = {
				method: 'get',
				headers: {
					'Content-Type': 'application/json'
				}
			}

			fetch('/arl/', opciones)
				.then(response => {
					if (response.ok)
						return response.text();
					else
						throw new Error(response.status);
				})
				.then(data => {
					var lista_arl = JSON.parse(data);
					sessionStorage.setItem("lista_arl", JSON.stringify(lista_arl));
				})
				.catch(err => {
					console.error("ERROR: ", err.message)
				});
		}
		getAllArlFetch();
	</script>
<script>
		lista_arl = JSON.parse(sessionStorage.getItem("lista_arl"));
		let select = document.getElementById("id_arl");
		
		lista_arl.forEach(item => {
			let option = document.createElement("option");
			option.value = item["id"];
			option.textContent = item["nombre"];
			select.appendChild(option);
		});
		
		let option = document.createElement("option");
		option.value = -1;
		option.textContent = "No cuenta con ARL";
		select.appendChild(option);
	</script>
<!-- 	<script>


		function getAllArlFetch() {
			let opciones = {
				method: 'get',
				headers: {
					'Content-Type': 'application/json'
				}
			}

			fetch('/arl/', opciones)
				.then(response => {
					if (response.ok)
						return response.text();
					else
						throw new Error(response.status);
				})
				.then(data => {
					var lista_arl = JSON.parse(data);
					sessionStorage.setItem("lista_arl", JSON.stringify(lista_arl));
				})
				.catch(err => {
					console.error("ERROR: ", err.message)
				});
		}
		getAllArlFetch();
	</script>	
	
	<script>
		lista_arl = JSON.parse(sessionStorage.getItem("lista_arl"));

		let label = document.createElement("label");
		label.className = "";
		label.textContent = "ARL";

		let codigo_arl = document.createElement("input");
		let fecha_ingreso = document.createElement("input");
		let arl = document.createElement("select");

		codigo_arl.type = "text";
		codigo_arl.placeholder = "Codigo de usuario de ARL";
		codigo_arl.setAttribute("th:field","obrero.trabajador.afiliadoArl.codigo");
		fecha_ingreso.type = "date";
		fecha_ingreso.setAttribute("th:field","obrero.trabajador.afiliadoArl.fechaIngreso");
		let div = document.getElementById("arl");
		console.log(lista_arl);
		//llenado del select
		lista_arl.forEach(item => {
			let option = document.createElement("option");
			option.value = item["id"];
			option.textContent = item["nombre"];
			arl.appendChild(option);
			//console.log("Nombre: " + arl["nombre"]);
			//console.log(arl);
		});

		div.appendChild(label);
		div.appendChild(arl);
		div.appendChild(codigo_arl);
		div.appendChild(fecha_ingreso);
		//console.log(label);
		//let v2=div.getElementsByTagName[0];
		//console.log(v2);
		//div.removeChild(label);
		console.log(div);
		//console.log(label);

	</script> -->
	<!-- ./JAVASCRIPT -->
</body>
</html>